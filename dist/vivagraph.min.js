!function(e){var n;"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.Viva=e())}(function(){return function r(o,i,a){function s(t,e){if(!i[t]){if(!o[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}n=i[t]={exports:{}};o[t][0].call(n.exports,function(e){var n=o[t][1][e];return s(n||e)},n,n.exports,r,o,i,a)}return i[t].exports}for(var u="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,n,t){var r=e("ngraph.random"),o={lazyExtend:function(){return e("ngraph.merge").apply(this,arguments)},randomIterator:function(){return r.randomIterator.apply(r,arguments)},random:function(){return r.random.apply(r,arguments)},events:e("ngraph.events")};o.Graph={version:e("./version.js"),graph:e("ngraph.graph"),serializer:function(){return{loadFromJSON:e("ngraph.fromjson"),storeToJSON:e("ngraph.tojson")}},centrality:e("./Algorithms/centrality.js"),operations:e("./Algorithms/operations.js"),geom:function(){return{intersect:e("gintersect"),intersectRect:e("./Utils/intersectRect.js")}},webgl:e("./WebGL/webgl.js"),webglInputEvents:e("./WebGL/webglInputEvents.js"),generator:function(){return e("ngraph.generators")},Input:{domInputManager:e("./Input/domInputManager.js"),webglInputManager:e("./Input/webglInputManager.js")},Utils:{dragndrop:e("./Input/dragndrop.js"),findElementPosition:e("./Utils/findElementPosition.js"),timer:e("./Utils/timer.js"),getDimension:e("./Utils/getDimensions.js"),events:e("./Utils/backwardCompatibleEvents.js")},Layout:{forceDirected:e("ngraph.forcelayout"),constant:e("./Layout/constant.js")},View:{Texture:e("./WebGL/texture.js"),webglAtlas:e("./WebGL/webglAtlas.js"),webglImageNodeProgram:e("./WebGL/webglImageNodeProgram.js"),webglLinkProgram:e("./WebGL/webglLinkProgram.js"),webglNodeProgram:e("./WebGL/webglNodeProgram.js"),webglLine:e("./WebGL/webglLine.js"),webglSquare:e("./WebGL/webglSquare.js"),webglImage:e("./WebGL/webglImage.js"),webglGraphics:e("./View/webglGraphics.js"),_webglUtil:{parseColor:e("./WebGL/parseColor.js")},svgGraphics:e("./View/svgGraphics.js"),renderer:e("./View/renderer.js"),cssGraphics:function(){throw new Error("cssGraphics is deprecated. Please use older version of vivagraph (< 0.7) if you need it")},svgNodeFactory:function(){throw new Error("svgNodeFactory is deprecated. Please use older version of vivagraph (< 0.7) if you need it")},community:function(){throw new Error("community is deprecated. Please use vivagraph < 0.7 if you need it, or `https://github.com/anvaka/ngraph.slpa` module")}},Rect:e("./Utils/rect.js"),svg:e("simplesvg"),BrowserInfo:e("./Utils/browserInfo.js")},n.exports=o},{"./Algorithms/centrality.js":35,"./Algorithms/operations.js":36,"./Input/domInputManager.js":37,"./Input/dragndrop.js":38,"./Input/webglInputManager.js":39,"./Layout/constant.js":40,"./Utils/backwardCompatibleEvents.js":41,"./Utils/browserInfo.js":42,"./Utils/findElementPosition.js":44,"./Utils/getDimensions.js":45,"./Utils/intersectRect.js":46,"./Utils/rect.js":48,"./Utils/timer.js":49,"./View/renderer.js":51,"./View/svgGraphics.js":52,"./View/webglGraphics.js":53,"./WebGL/parseColor.js":54,"./WebGL/texture.js":55,"./WebGL/webgl.js":56,"./WebGL/webglAtlas.js":57,"./WebGL/webglImage.js":58,"./WebGL/webglImageNodeProgram.js":59,"./WebGL/webglInputEvents.js":60,"./WebGL/webglLine.js":61,"./WebGL/webglLinkProgram.js":62,"./WebGL/webglNodeProgram.js":63,"./WebGL/webglSquare.js":64,"./version.js":65,gintersect:3,"ngraph.events":9,"ngraph.forcelayout":10,"ngraph.fromjson":24,"ngraph.generators":25,"ngraph.graph":27,"ngraph.merge":28,"ngraph.random":29,"ngraph.tojson":30,simplesvg:31}],2:[function(e,n,t){r.removeEventListener=function(e,n,t,r){return(o=o||(document.addEventListener?{add:i,rm:a}:{add:s,rm:u})).rm(e,n,t,r)},r.addEventListener=r,n.exports=r;var o=null;function r(e,n,t,r){return(o=o||(document.addEventListener?{add:i,rm:a}:{add:s,rm:u})).add(e,n,t,r)}function i(e,n,t,r){e.addEventListener(n,t,r)}function a(e,n,t,r){e.removeEventListener(n,t,r)}function s(e,n,t,r){if(r)throw new Error("cannot useCapture in oldIE");e.attachEvent("on"+n,t)}function u(e,n,t,r){e.detachEvent("on"+n,t)}},{}],3:[function(e,n,t){n.exports=function(e,n,t,r,o,i,a,s){var u,d,f,c,l,p,v={x:0,y:0};return l=(u=r-n)*a+(d=e-t)*s+(f=t*n-e*r),0==(c=u*o+d*i+f)||0==l||0<=c!=4<=l?(s=(l=s-i)*t+(t=o-a)*r+(o=a*i-o*s),(0==(n=l*e+t*n+o)||0==s||0<=n!=0<=s)&&0!=(p=u*t-l*d)?(t=d*o-t*f,v.x=(t<0?+t:t+0)/p,t=l*f-u*o,v.y=(t<0?+t:t+0)/p,v):null):null}},{}],4:[function(e,n,t){n.exports.degree=e("./src/degree.js"),n.exports.betweenness=e("./src/betweenness.js"),n.exports.closeness=e("./src/closeness.js"),n.exports.eccentricity=e("./src/eccentricity.js")},{"./src/betweenness.js":5,"./src/closeness.js":6,"./src/degree.js":7,"./src/eccentricity.js":8}],5:[function(e,n,t){n.exports=function(i,r){var a,o=[],s=[],u=Object.create(null),d=Object.create(null),f=Object.create(null),c=Object.create(null),l=Object.create(null);i.forEachNode(function(e){l[e.id]=0}),i.forEachNode(function(e){(function(e){for(i.forEachNode(function(e){e=e.id;u[e]=[],d[e]=-1,f[e]=0}),d[e]=0,f[e]=1,o.push(e);o.length;){var n=o.shift();s.push(n),i.forEachLinkedNode(n,t,r)}function t(e){e=e.id,-1===d[e]&&(d[e]=d[n]+1,o.push(e)),d[e]===d[n]+1&&(f[e]+=f[n],u[e].push(n))}})(a=e.id),function(){for(i.forEachNode(p);s.length;){for(var e=s.pop(),n=(1+c[e])/f[e],t=u[e],r=0;r<t.length;++r){var o=t[r];c[o]+=f[o]*n}e!==a&&(l[e]+=c[e])}}()}),r||Object.keys(l).forEach(function(e){l[e]/=2});return l;function p(e){c[e.id]=0}}},{}],6:[function(e,n,t){n.exports=function(r,o){var t,i=[],a=Object.create(null),s=Object.create(null);return r.forEachNode(function(e){s[e.id]=0}),r.forEachNode(function(e){(function(e){for(r.forEachNode(function(e){e=e.id;a[e]=-1}),a[e]=0,i.push(e);i.length;){var n=i.shift();r.forEachLinkedNode(n,t,o)}function t(e){e=e.id;-1===a[e]&&(a[e]=a[n]+1,i.push(e))}})(t=e.id),function(){var e=(n=Object.keys(a).map(function(e){return a[e]}).filter(function(e){return-1!==e})).length,n=n.reduce(function(e,n){return e+n});s[t]=0<n?(e-1)/n:0}()}),s}},{}],7:[function(e,n,t){function i(e,n){var t=0;if(!e)return t;for(var r=0;r<e.length;r+=1)t+=e[r].toId===n?1:0;return t}function a(e,n){var t=0;if(!e)return t;for(var r=0;r<e.length;r+=1)t+=e[r].fromId===n?1:0;return t}function s(e){return e?e.length:0}n.exports=function(t,e){var r,o=Object.create(null);if("both"===(e=(e||"both").toLowerCase())||"inout"===e)r=s;else if("in"===e)r=i;else{if("out"!==e)throw new Error("Expected centrality degree kind is: in, out or both");r=a}return t.forEachNode(function(e){var n=t.getLinks(e.id);o[e.id]=r(n,e.id)}),o}},{}],8:[function(e,n,t){n.exports=function(r,o){var t,i=[],a=Object.create(null),s=Object.create(null);return r.forEachNode(function(e){s[e.id]=0}),r.forEachNode(function(e){(function(e){for(r.forEachNode(function(e){e=e.id;a[e]=-1}),a[e]=0,i.push(e);i.length;){var n=i.shift();r.forEachLinkedNode(n,t,o)}function t(e){e=e.id;-1===a[e]&&(a[e]=a[n]+1,i.push(e))}})(t=e.id),function(){var n=0;Object.keys(a).forEach(function(e){e=a[e];n<e&&(n=e)}),s[t]=n}()}),s}},{}],9:[function(e,n,t){n.exports=function(e){!function(e){if(!e)throw new Error("Eventify cannot use falsy object as events subject");for(var n=["on","fire","off"],t=0;t<n.length;++t)if(e.hasOwnProperty(n[t]))throw new Error("Subject cannot be eventified, since it already has property '"+n[t]+"'")}(e);var i,a,n=(i=e,a=Object.create(null),{on:function(e,n,t){if("function"!=typeof n)throw new Error("callback is expected to be a function");return(a[e]||(a[e]=[])).push({callback:n,ctx:t}),i},off:function(e,n){if(void 0===e)return a=Object.create(null),i;if(a[e])if("function"!=typeof n)delete a[e];else for(var t=a[e],r=0;r<t.length;++r)t[r].callback===n&&t.splice(r,1);return i},fire:function(e){var n,t=a[e];if(!t)return i;1<arguments.length&&(n=Array.prototype.splice.call(arguments,1));for(var r=0;r<t.length;++r){var o=t[r];o.callback.apply(o.ctx,n)}return i}});return e.on=n.on,e.off=n.off,e.fire=n.fire,e}},{}],10:[function(m,e,n){e.exports=function(a,e){if(!a)throw new Error("Graph structure cannot be undefined");var s=(e&&e.createSimulator||m("./lib/createPhysicsSimulator"))(e);if(Array.isArray(e))throw new Error("Physics settings is expected to be an object");var t=19<a.version?function(e){e=a.getLinks(e);return e?1+e.size/3:1}:function(e){e=a.getLinks(e);return e?1+e.length/3:1};e&&"function"==typeof e.nodeMass&&(t=e.nodeMass);var u=new Map,d={},f=0,r=s.settings.springTransform||b;f=0,a.forEachNode(function(e){p(e.id),f+=1}),a.forEachLink(v),a.on("changed",l);var n=!1,o={step:function(){if(console.log("making step; edit works"),0===f)return i(!0),!0;var e=s.step();o.lastMove=e,o.fire("step");e=e/f<=.01;return i(e),e},getNodePosition:function(e){return g(e).pos},setNodePosition:function(e){var n=g(e);n.setPosition.apply(n,Array.prototype.slice.call(arguments,1))},getLinkPosition:function(e){e=d[e];if(e)return{from:e.from.pos,to:e.to.pos}},getGraphRect:function(){return s.getBBox()},forEachBody:c,pinNode:function(e,n){g(e.id).isPinned=!!n},isNodePinned:function(e){return g(e.id).isPinned},dispose:function(){a.off("changed",l),o.fire("disposed")},getBody:function(e){return u.get(e)},getSpring:function(e,n){var t;if(void 0===n)t="object"!=typeof e?e:e.id;else{n=a.hasLink(e,n);if(!n)return;t=n.id}return d[t]},getForceVectorLength:function(){var n=0,t=0;return c(function(e){n+=Math.abs(e.force.x),t+=Math.abs(e.force.y)}),Math.sqrt(n*n+t*t)},simulator:s,graph:a,lastMove:0};return y(o),o;function i(e){n!==e&&(e=n=e,o.fire("stable",e))}function c(e){u.forEach(e)}function l(e){for(var n,t,r,o=0;o<e.length;++o){var i=e[o];"add"===i.changeType?(i.node&&p(i.node.id),i.link&&v(i.link)):"remove"===i.changeType&&(i.node&&(t=i.node,r=void 0,r=t.id,(t=u.get(r))&&(u.delete(r),s.removeBody(t))),i.link&&(n=i.link,i=t=r=void 0,(i=d[n.id])&&(r=a.getNode(n.fromId),t=a.getNode(n.toId),r&&h(r.id),t&&h(t.id),delete d[n.id],s.removeSpring(i))))}f=a.getNodesCount()}function p(e){var n=u.get(e);if(!n){var t=a.getNode(e);if(!t)throw new Error("initBody() was called with unknown node id");var r,o=t.position;o||(r=function(e){var n=[];if(!e.links)return n;for(var t=Math.min(e.links.length,2),r=0;r<t;++r){var o=e.links[r],o=o.fromId!==e.id?u.get(o.fromId):u.get(o.toId);o&&o.pos&&n.push(o)}return n}(t),o=s.getBestNewBodyPosition(r)),(n=s.addBodyAt(o)).id=e,u.set(e,n),h(e),(t=t)&&(t.isPinned||t.data&&t.data.isPinned)&&(n.isPinned=!0)}}function v(e){h(e.fromId),h(e.toId);var n=u.get(e.fromId),t=u.get(e.toId),t=s.addSpring(n,t,e.length);r(e,t),d[e.id]=t}function h(e){var n=u.get(e);if(n.mass=t(e),Number.isNaN(n.mass))throw new Error("Node mass should be a number")}function g(e){var n=u.get(e);return n||(p(e),n=u.get(e)),n}},e.exports.simulator=m("./lib/createPhysicsSimulator");var y=m("ngraph.events");function b(){}},{"./lib/createPhysicsSimulator":19,"ngraph.events":21}],11:[function(e,n,t){const d=e("./getVariableName");n.exports=function(u){return function(n,e){let t=e&&e.indent||0,r=e&&void 0!==e.join?e.join:"\n",o=Array(t+1).join(" "),i=[];for(let e=0;e<u;++e){var a=d(e),s=0===e?"":o;i.push(s+n.replace(/{var}/g,a))}return i.join(r)}}},{"./getVariableName":18}],12:[function(e,n,t){n.exports=function(e){e=o(e);return new Function("bodies","settings","random",e)},n.exports.generateFunctionBody=o;const r=e("./createPatternBuilder");function o(e){let n=r(e);return`
  var boundingBox = {
    ${n("min_{var}: 0, max_{var}: 0,",{indent:4})}
  };

  return {
    box: boundingBox,

    update: updateBoundingBox,

    reset: resetBoundingBox,

    getBestNewPosition: function (neighbors) {
      var ${n("base_{var} = 0",{join:", "})};

      if (neighbors.length) {
        for (var i = 0; i < neighbors.length; ++i) {
          let neighborPos = neighbors[i].pos;
          ${n("base_{var} += neighborPos.{var};",{indent:10})}
        }

        ${n("base_{var} /= neighbors.length;",{indent:8})}
      } else {
        ${n("base_{var} = (boundingBox.min_{var} + boundingBox.max_{var}) / 2;",{indent:8})}
      }

      var springLength = settings.springLength;
      return {
        ${n("{var}: base_{var} + (random.nextDouble() - 0.5) * springLength,",{indent:8})}
      };
    }
  };

  function updateBoundingBox() {
    var i = bodies.length;
    if (i === 0) return; // No bodies - no borders.

    ${n("var max_{var} = -Infinity;",{indent:4})}
    ${n("var min_{var} = Infinity;",{indent:4})}

    while(i--) {
      // this is O(n), it could be done faster with quadtree, if we check the root node bounds
      var bodyPos = bodies[i].pos;
      ${n("if (bodyPos.{var} < min_{var}) min_{var} = bodyPos.{var};",{indent:6})}
      ${n("if (bodyPos.{var} > max_{var}) max_{var} = bodyPos.{var};",{indent:6})}
    }

    ${n("boundingBox.min_{var} = min_{var};",{indent:4})}
    ${n("boundingBox.max_{var} = max_{var};",{indent:4})}
  }

  function resetBoundingBox() {
    ${n("boundingBox.min_{var} = boundingBox.max_{var} = 0;",{indent:4})}
  }
`}},{"./createPatternBuilder":11}],13:[function(e,n,t){const o=e("./createPatternBuilder");function r(e,n){return`
${a(e,n)}
${i(e)}
return {Body: Body, Vector: Vector};
`}function i(e){let n=o(e);e=n("{var}",{join:", "});return`
function Body(${e}) {
  this.isPinned = false;
  this.pos = new Vector(${e});
  this.force = new Vector();
  this.velocity = new Vector();
  this.mass = 1;

  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.reset = function() {
  this.force.reset();
  this.springCount = 0;
  this.springLength = 0;
}

Body.prototype.setPosition = function (${e}) {
  ${n("this.pos.{var} = {var} || 0;",{indent:2})}
};`}function a(e,n){let t=o(e),r="";return n&&(r=`${t("\n   var v{var};\nObject.defineProperty(this, '{var}', {\n  set: function(v) { \n    if (!Number.isFinite(v)) throw new Error('Cannot set non-numbers to {var}');\n    v{var} = v; \n  },\n  get: function() { return v{var}; }\n});")}`),`function Vector(${t("{var}",{join:", "})}) {
  ${r}
    if (typeof arguments[0] === 'object') {
      // could be another vector
      let v = arguments[0];
      ${t('if (!Number.isFinite(v.{var})) throw new Error("Expected value is not a finite number at Vector constructor ({var})");',{indent:4})}
      ${t("this.{var} = v.{var};",{indent:4})}
    } else {
      ${t('this.{var} = typeof {var} === "number" ? {var} : 0;',{indent:4})}
    }
  }
  
  Vector.prototype.reset = function () {
    ${t("this.{var} = ",{join:""})}0;
  };`}n.exports=function(e,n){var n=r(e,n),{Body:n}=new Function(n)();return n},n.exports.generateCreateBodyFunctionBody=r,n.exports.getVectorCode=a,n.exports.getBodyCode=i},{"./createPatternBuilder":11}],14:[function(e,n,t){const r=e("./createPatternBuilder");function o(e){let n=r(e);return`
  if (!Number.isFinite(options.dragCoefficient)) throw new Error('dragCoefficient is not a finite number');

  return {
    update: function(body) {
      ${n("body.force.{var} -= options.dragCoefficient * body.velocity.{var};",{indent:6})}
    }
  };
`}n.exports=function(e){e=o(e);return new Function("options",e)},n.exports.generateCreateDragForceFunctionBody=o},{"./createPatternBuilder":11}],15:[function(e,n,t){const r=e("./createPatternBuilder");function o(e){let n=r(e);return`
  if (!Number.isFinite(options.springCoefficient)) throw new Error('Spring coefficient is not a number');
  if (!Number.isFinite(options.springLength)) throw new Error('Spring length is not a number');

  return {
    /**
     * Updates forces acting on a spring
     */
    update: function (spring) {
      var body1 = spring.from;
      var body2 = spring.to;
      var length = spring.length < 0 ? options.springLength : spring.length;
      ${n("var d{var} = body2.pos.{var} - body1.pos.{var};",{indent:6})}
      var r = Math.sqrt(${n("d{var} * d{var}",{join:" + "})});

      if (r === 0) {
        ${n("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:8})}
        r = Math.sqrt(${n("d{var} * d{var}",{join:" + "})});
      }

      var d = r - length;
      var coefficient = ((spring.coefficient > 0) ? spring.coefficient : options.springCoefficient) * d / r;

      ${n("body1.force.{var} += coefficient * d{var}",{indent:6})};
      body1.springCount += 1;
      body1.springLength += r;

      ${n("body2.force.{var} -= coefficient * d{var}",{indent:6})};
      body2.springCount += 1;
      body2.springLength += r;
    }
  };
`}n.exports=function(e){e=o(e);return new Function("options","random",e)},n.exports.generateCreateSpringForceFunctionBody=o},{"./createPatternBuilder":11}],16:[function(e,n,t){const r=e("./createPatternBuilder");function o(e){let n=r(e);return`
  var length = bodies.length;
  if (length === 0) return 0;

  ${n("var d{var} = 0, t{var} = 0;",{indent:2})}

  for (var i = 0; i < length; ++i) {
    var body = bodies[i];
    if (body.isPinned) continue;

    if (adaptiveTimeStepWeight && body.springCount) {
      timeStep = (adaptiveTimeStepWeight * body.springLength/body.springCount);
    }

    var coeff = timeStep / body.mass;

    ${n("body.velocity.{var} += coeff * body.force.{var};",{indent:4})}
    ${n("var v{var} = body.velocity.{var};",{indent:4})}
    var v = Math.sqrt(${n("v{var} * v{var}",{join:" + "})});

    if (v > 1) {
      // We normalize it so that we move within timeStep range. 
      // for the case when v <= 1 - we let velocity to fade out.
      ${n("body.velocity.{var} = v{var} / v;",{indent:6})}
    }

    ${n("d{var} = timeStep * body.velocity.{var};",{indent:4})}

    ${n("body.pos.{var} += d{var};",{indent:4})}

    ${n("t{var} += Math.abs(d{var});",{indent:4})}
  }

  return (${n("t{var} * t{var}",{join:" + "})})/length;
`}n.exports=function(e){e=o(e);return new Function("bodies","timeStep","adaptiveTimeStepWeight",e)},n.exports.generateIntegratorFunctionBody=o},{"./createPatternBuilder":11}],17:[function(e,n,t){const i=e("./createPatternBuilder"),a=e("./getVariableName");function r(r){let e=i(r);var o=Math.pow(2,r);return`
${c()}
${f(r)}
${s(r)}
${d(r)}
${u(r)}

function createQuadTree(options, random) {
  options = options || {};
  options.gravity = typeof options.gravity === 'number' ? options.gravity : -1;
  options.theta = typeof options.theta === 'number' ? options.theta : 0.8;

  var gravity = options.gravity;
  var updateQueue = [];
  var insertStack = new InsertStack();
  var theta = options.theta;

  var nodesCache = [];
  var currentInCache = 0;
  var root = newNode();

  return {
    insertBodies: insertBodies,

    /**
     * Gets root node if it is present
     */
    getRoot: function() {
      return root;
    },

    updateBodyForce: update,

    options: function(newOptions) {
      if (newOptions) {
        if (typeof newOptions.gravity === 'number') {
          gravity = newOptions.gravity;
        }
        if (typeof newOptions.theta === 'number') {
          theta = newOptions.theta;
        }

        return this;
      }

      return {
        gravity: gravity,
        theta: theta
      };
    }
  };

  function newNode() {
    // To avoid pressure on GC we reuse nodes.
    var node = nodesCache[currentInCache];
    if (node) {
${function(n){let t=[];for(let e=0;e<o;++e)t.push(`${n}quad${e} = null;`);return t.join("\n")}("      node.")}
      node.body = null;
      node.mass = ${e("node.mass_{var} = ",{join:""})}0;
      ${e("node.min_{var} = node.max_{var} = ",{join:""})}0;
    } else {
      node = new QuadNode();
      nodesCache[currentInCache] = node;
    }

    ++currentInCache;
    return node;
  }

  function update(sourceBody) {
    var queue = updateQueue;
    var v;
    ${e("var d{var};",{indent:4})}
    var r; 
    ${e("var f{var} = 0;",{indent:4})}
    var queueLength = 1;
    var shiftIdx = 0;
    var pushIdx = 1;

    queue[0] = root;

    while (queueLength) {
      var node = queue[shiftIdx];
      var body = node.body;

      queueLength -= 1;
      shiftIdx += 1;
      var differentBody = (body !== sourceBody);
      if (body && differentBody) {
        // If the current node is a leaf node (and it is not source body),
        // calculate the force exerted by the current node on body, and add this
        // amount to body's net force.
        ${e("d{var} = body.pos.{var} - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Poor man's protection against zero distance.
          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
        }

        // This is standard gravitation force calculation but we divide
        // by r^3 to save two operations when normalizing force vector.
        v = gravity * body.mass * sourceBody.mass / (r * r * r);
        ${e("f{var} += v * d{var};",{indent:8})}
      } else if (differentBody) {
        // Otherwise, calculate the ratio s / r,  where s is the width of the region
        // represented by the internal node, and r is the distance between the body
        // and the node's center-of-mass
        ${e("d{var} = node.mass_{var} / node.mass - sourceBody.pos.{var};",{indent:8})}
        r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});

        if (r === 0) {
          // Sorry about code duplication. I don't want to create many functions
          // right away. Just want to see performance first.
          ${e("d{var} = (random.nextDouble() - 0.5) / 50;",{indent:10})}
          r = Math.sqrt(${e("d{var} * d{var}",{join:" + "})});
        }
        // If s / r < Î¸, treat this internal node as a single body, and calculate the
        // force it exerts on sourceBody, and add this amount to sourceBody's net force.
        if ((node.max_${a(0)} - node.min_${a(0)}) / r < theta) {
          // in the if statement above we consider node's width only
          // because the region was made into square during tree creation.
          // Thus there is no difference between using width or height.
          v = gravity * node.mass * sourceBody.mass / (r * r * r);
          ${e("f{var} += v * d{var};",{indent:10})}
        } else {
          // Otherwise, run the procedure recursively on each of the current node's children.

          // I intentionally unfolded this loop, to save several CPU cycles.
${function(){let n=Array(11).join(" "),t=[];for(let e=0;e<o;++e)t.push(n+`if (node.quad${e}) {`),t.push(n+`  queue[pushIdx] = node.quad${e};`),t.push(n+"  queueLength += 1;"),t.push(n+"  pushIdx += 1;"),t.push(n+"}");return t.join("\n")}()}
        }
      }
    }

    ${e("sourceBody.force.{var} += f{var};",{indent:4})}
  }

  function insertBodies(bodies) {
    ${e("var {var}min = Number.MAX_VALUE;",{indent:4})}
    ${e("var {var}max = Number.MIN_VALUE;",{indent:4})}
    var i = bodies.length;

    // To reduce quad tree depth we are looking for exact bounding box of all particles.
    while (i--) {
      var pos = bodies[i].pos;
      ${e("if (pos.{var} < {var}min) {var}min = pos.{var};",{indent:6})}
      ${e("if (pos.{var} > {var}max) {var}max = pos.{var};",{indent:6})}
    }

    // Makes the bounds square.
    var maxSideLength = -Infinity;
    ${e("if ({var}max - {var}min > maxSideLength) maxSideLength = {var}max - {var}min ;",{indent:4})}

    currentInCache = 0;
    root = newNode();
    ${e("root.min_{var} = {var}min;",{indent:4})}
    ${e("root.max_{var} = {var}min + maxSideLength;",{indent:4})}

    i = bodies.length - 1;
    if (i >= 0) {
      root.body = bodies[i];
    }
    while (i--) {
      insert(bodies[i], root);
    }
  }

  function insert(newBody) {
    insertStack.reset();
    insertStack.push(root, newBody);

    while (!insertStack.isEmpty()) {
      var stackItem = insertStack.pop();
      var node = stackItem.node;
      var body = stackItem.body;

      if (!node.body) {
        // This is internal node. Update the total mass of the node and center-of-mass.
        ${e("var {var} = body.pos.{var};",{indent:8})}
        node.mass += body.mass;
        ${e("node.mass_{var} += body.mass * {var};",{indent:8})}

        // Recursively insert the body in the appropriate quadrant.
        // But first find the appropriate quadrant.
        var quadIdx = 0; // Assume we are in the 0's quad.
        ${e("var min_{var} = node.min_{var};",{indent:8})}
        ${e("var max_{var} = (min_{var} + node.max_{var}) / 2;",{indent:8})}

${function(e){let n=[],t=Array(e+1).join(" ");for(let e=0;e<r;++e)n.push(t+`if (${a(e)} > max_${a(e)}) {`),n.push(t+`  quadIdx = quadIdx + ${Math.pow(2,e)};`),n.push(t+`  min_${a(e)} = max_${a(e)};`),n.push(t+`  max_${a(e)} = node.max_${a(e)};`),n.push(t+"}");return n.join("\n")}(8)}

        var child = getChild(node, quadIdx);

        if (!child) {
          // The node is internal but this quadrant is not taken. Add
          // subnode to it.
          child = newNode();
          ${e("child.min_{var} = min_{var};",{indent:10})}
          ${e("child.max_{var} = max_{var};",{indent:10})}
          child.body = body;

          setChild(node, quadIdx, child);
        } else {
          // continue searching in this quadrant.
          insertStack.push(child, body);
        }
      } else {
        // We are trying to add to the leaf node.
        // We have to convert current leaf into internal node
        // and continue adding two nodes.
        var oldBody = node.body;
        node.body = null; // internal nodes do not cary bodies

        if (isSamePosition(oldBody.pos, body.pos)) {
          // Prevent infinite subdivision by bumping one node
          // anywhere in this quadrant
          var retriesCount = 3;
          do {
            var offset = random.nextDouble();
            ${e("var d{var} = (node.max_{var} - node.min_{var}) * offset;",{indent:12})}

            ${e("oldBody.pos.{var} = node.min_{var} + d{var};",{indent:12})}
            retriesCount -= 1;
            // Make sure we don't bump it out of the box. If we do, next iteration should fix it
          } while (retriesCount > 0 && isSamePosition(oldBody.pos, body.pos));

          if (retriesCount === 0 && isSamePosition(oldBody.pos, body.pos)) {
            // This is very bad, we ran out of precision.
            // if we do not return from the method we'll get into
            // infinite loop here. So we sacrifice correctness of layout, and keep the app running
            // Next layout iteration should get larger bounding box in the first step and fix this
            return;
          }
        }
        // Next iteration should subdivide node further.
        insertStack.push(node, oldBody);
        insertStack.push(node, body);
      }
    }
  }
}
return createQuadTree;

`}function s(e){let n=i(e);return`
  function isSamePosition(point1, point2) {
    ${n("var d{var} = Math.abs(point1.{var} - point2.{var});",{indent:2})}
  
    return ${n("d{var} < 1e-8",{join:" && "})};
  }  
`}function u(e){var r=Math.pow(2,e);return`
function setChild(node, idx, child) {
  ${function(){let n=[];for(let e=0;e<r;++e){var t=0===e?"  ":"  else ";n.push(`${t}if (idx === ${e}) node.quad${e} = child;`)}return n.join("\n")}()}
}`}function d(e){return`function getChild(node, idx) {
${function(){let n=[],t=Math.pow(2,e);for(let e=0;e<t;++e)n.push(`  if (idx === ${e}) return node.quad${e};`);return n.join("\n")}()}
  return null;
}`}function f(e){let n=i(e);var r=Math.pow(2,e);return`
function QuadNode() {
  // body stored inside this node. In quad tree only leaf nodes (by construction)
  // contain bodies:
  this.body = null;

  // Child nodes are stored in quads. Each quad is presented by number:
  // 0 | 1
  // -----
  // 2 | 3
${function(n){let t=[];for(let e=0;e<r;++e)t.push(`${n}quad${e} = null;`);return t.join("\n")}("  this.")}

  // Total mass of current node
  this.mass = 0;

  // Center of mass coordinates
  ${n("this.mass_{var} = 0;",{indent:2})}

  // bounding box coordinates
  ${n("this.min_{var} = 0;",{indent:2})}
  ${n("this.max_{var} = 0;",{indent:2})}
}
`}function c(){return`
/**
 * Our implementation of QuadTree is non-recursive to avoid GC hit
 * This data structure represent stack of elements
 * which we are trying to insert into quad tree.
 */
function InsertStack () {
    this.stack = [];
    this.popIdx = 0;
}

InsertStack.prototype = {
    isEmpty: function() {
        return this.popIdx === 0;
    },
    push: function (node, body) {
        var item = this.stack[this.popIdx];
        if (!item) {
            // we are trying to avoid memory pressure: create new element
            // only when absolutely necessary
            this.stack[this.popIdx] = new InsertStackElement(node, body);
        } else {
            item.node = node;
            item.body = body;
        }
        ++this.popIdx;
    },
    pop: function () {
        if (this.popIdx > 0) {
            return this.stack[--this.popIdx];
        }
    },
    reset: function () {
        this.popIdx = 0;
    }
};

function InsertStackElement(node, body) {
    this.node = node; // QuadTree node
    this.body = body; // physical body which needs to be inserted to node
}
`}n.exports=function(e){e=r(e);return new Function(e)()},n.exports.generateQuadTreeFunctionBody=r,n.exports.getInsertStackCode=c,n.exports.getQuadNodeCode=f,n.exports.isSamePosition=s,n.exports.getChildBodyCode=d,n.exports.setChildBodyCode=u},{"./createPatternBuilder":11,"./getVariableName":18}],18:[function(e,n,t){n.exports=function(e){return 0===e?"x":1===e?"y":2===e?"z":"c"+(e+1)}},{}],19:[function(x,e,n){e.exports=function(t){var o=x("./spring"),e=x("ngraph.merge"),n=x("ngraph.events");if(t){if(void 0!==t.springCoeff)throw new Error("springCoeff was renamed to springCoefficient");if(void 0!==t.dragCoeff)throw new Error("dragCoeff was renamed to dragCoefficient")}t=e(t,{springLength:10,springCoefficient:.8,gravity:-12,theta:.8,dragCoefficient:.9,timeStep:.5,adaptiveTimeStepWeight:0,dimensions:2,debug:!1});var r=P[t.dimensions];r||(u=t.dimensions,r={Body:E(u,t.debug),createQuadTree:L(u),createBounds:_(u),createDragForce:j(u),createSpringForce:N(u),integrate:k(u)},P[u]=r);var i=r.Body,a=r.createQuadTree,s=r.createBounds,e=r.createDragForce,u=r.createSpringForce,d=r.integrate,r=x("ngraph.random").random(42),f=[],c=[],l=a(t,r),p=s(f,t,r),v=u(t,r),h=e(t),g=[],m=new Map,y=0;w("nbody",function(){if(0===f.length)return;l.insertBodies(f);var e=f.length;for(;e--;){var n=f[e];n.isPinned||(n.reset(),l.updateBodyForce(n),h.update(n))}}),w("spring",function(){var e=c.length;for(;e--;)v.update(c[e])});r={bodies:f,quadTree:l,springs:c,settings:t,addForce:w,removeForce:function(e){var n=g.indexOf(m.get(e));if(n<0)return;g.splice(n,1),m.delete(e)},getForces:function(){return m},step:function(){for(var e=0;e<g.length;++e)g[e](y);var n=d(f,t.timeStep,t.adaptiveTimeStepWeight);return y+=1,n},addBody:function(e){if(!e)throw new Error("Body is required");return f.push(e),e},addBodyAt:function(e){if(!e)throw new Error("Body position is required");e=new i(e);return f.push(e),e},removeBody:function(e){if(e){e=f.indexOf(e);if(!(e<0))return f.splice(e,1),0===f.length&&p.reset(),!0}},addSpring:function(e,n,t,r){if(!e||!n)throw new Error("Cannot add null spring to force simulator");r=new o(e,n,t="number"!=typeof t?-1:t,0<=r?r:-1);return c.push(r),r},getTotalMovement:function(){return 0},removeSpring:function(e){if(e){e=c.indexOf(e);return-1<e?(c.splice(e,1),!0):void 0}},getBestNewBodyPosition:function(e){return p.getBestNewPosition(e)},getBBox:b,getBoundingBox:b,invalidateBBox:function(){console.warn("invalidateBBox() is deprecated, bounds always recomputed on `getBBox()` call")},gravity:function(e){return void 0!==e?(t.gravity=e,l.options({gravity:e}),this):t.gravity},theta:function(e){return void 0!==e?(t.theta=e,l.options({theta:e}),this):t.theta},random:r};return function(e,n){for(var t in e)!function(n,t,r){n.hasOwnProperty(r)&&"function"!=typeof t[r]&&(Number.isFinite(n[r])?t[r]=function(e){if(void 0===e)return n[r];if(!Number.isFinite(e))throw new Error("Value of "+r+" should be a valid number.");return n[r]=e,t}:t[r]=function(e){return void 0!==e?(n[r]=e,t):n[r]})}(e,n,t)}(t,r),n(r),r;function b(){return p.update(),p.box}function w(e,n){if(m.has(e))throw new Error("Force "+e+" is already added");m.set(e,n),g.push(n)}};var E=x("./codeGenerators/generateCreateBody"),L=x("./codeGenerators/generateQuadTree"),_=x("./codeGenerators/generateBounds"),j=x("./codeGenerators/generateCreateDragForce"),N=x("./codeGenerators/generateCreateSpringForce"),k=x("./codeGenerators/generateIntegrator"),P={}},{"./codeGenerators/generateBounds":12,"./codeGenerators/generateCreateBody":13,"./codeGenerators/generateCreateDragForce":14,"./codeGenerators/generateCreateSpringForce":15,"./codeGenerators/generateIntegrator":16,"./codeGenerators/generateQuadTree":17,"./spring":20,"ngraph.events":21,"ngraph.merge":22,"ngraph.random":23}],20:[function(e,n,t){n.exports=function(e,n,t,r){this.from=e,this.to=n,this.length=t,this.coefficient=r}},{}],21:[function(e,n,t){n.exports=function(e){!function(e){if(!e)throw new Error("Eventify cannot use falsy object as events subject");for(var n=["on","fire","off"],t=0;t<n.length;++t)if(e.hasOwnProperty(n[t]))throw new Error("Subject cannot be eventified, since it already has property '"+n[t]+"'")}(e);var i,a,n=(i=e,a=Object.create(null),{on:function(e,n,t){if("function"!=typeof n)throw new Error("callback is expected to be a function");return(a[e]||(a[e]=[])).push({callback:n,ctx:t}),i},off:function(e,n){if(void 0===e)return a=Object.create(null),i;if(a[e])if("function"!=typeof n)delete a[e];else for(var t=a[e],r=0;r<t.length;++r)t[r].callback===n&&t.splice(r,1);return i},fire:function(e){var n,t=a[e];if(!t)return i;1<arguments.length&&(n=Array.prototype.splice.call(arguments,1));for(var r=0;r<t.length;++r){var o=t[r];o.callback.apply(o.ctx,n)}return i}});return e.on=n.on,e.off=n.off,e.fire=n.fire,e}},{}],22:[function(e,n,t){n.exports=function e(n,t){n=n||{};if(t)for(var r in t){var o,i;t.hasOwnProperty(r)&&(o=n.hasOwnProperty(r),i=typeof t[r],!o||typeof n[r]!=i?n[r]=t[r]:"object"==i&&(n[r]=e(n[r],t[r])))}return n}},{}],23:[function(e,n,t){function r(e){return new o("number"==typeof e?e:+new Date)}function o(e){this.seed=e}function i(e){return Math.sqrt(2*Math.PI/e)*Math.pow(1/Math.E*(e+1/(12*e-1/(10*e))),e)}function a(){var e=this.seed;return e=4294967295&(3042594569^(e=4251993797+(e=4294967295&(3550635116+(e=374761393+(e=4294967295&(3345072700^(e=e+2127912214+(e<<12)&4294967295)^e>>>19))+(e<<5)&4294967295)^e<<9))+(e<<3)&4294967295)^e>>>16),(268435455&(this.seed=e))/268435456}n.exports=r,n.exports.random=r,n.exports.randomIterator=function(o,e){var i=e||r();if("function"==typeof i.next)return{forEach:function(e){var n,t,r;for(n=o.length-1;0<n;--n)t=i.next(n+1),r=o[t],o[t]=o[n],o[n]=r,e(r);o.length&&e(o[0])},shuffle:function(){var e,n,t;for(e=o.length-1;0<e;--e)n=i.next(e+1),t=o[n],o[n]=o[e],o[e]=t;return o}};throw new Error("customRandom does not match expected API: next() function is missing")},o.prototype.next=function(e){return Math.floor(this.nextDouble()*e)},o.prototype.nextDouble=a,o.prototype.uniform=a,o.prototype.gaussian=function(){var e,n,t;for(;n=2*this.nextDouble()-1,t=2*this.nextDouble()-1,e=n*n+t*t,1<=e||0===e;);return n*Math.sqrt(-2*Math.log(e)/e)},o.prototype.levy=function(){var e=Math.pow(i(2.5)*Math.sin(1.5*Math.PI/2)/(1.5*i(1.25)*Math.pow(2,.25)),1/1.5);return this.gaussian()*e/Math.pow(Math.abs(this.gaussian()),1/1.5)}},{}],24:[function(e,n,t){n.exports=function(e,n,t){var r;n=n||d,t=t||d,r="string"==typeof e?JSON.parse(e):e;var o,i=u();if(void 0===r.links||void 0===r.nodes)throw new Error("Cannot load graph without links and nodes");for(o=0;o<r.nodes.length;++o){var a=n(r.nodes[o]);if(!a.hasOwnProperty("id"))throw new Error("Graph node format is invalid: Node id is missing");i.addNode(a.id,a.data)}for(o=0;o<r.links.length;++o){var s=t(r.links[o]);if(!s.hasOwnProperty("fromId")||!s.hasOwnProperty("toId"))throw new Error("Graph link format is invalid. Both fromId and toId are required");i.addLink(s.fromId,s.toId,s.data)}return i};var u=e("ngraph.graph");function d(e){return e}},{"ngraph.graph":27}],25:[function(h,e,n){var t=h("ngraph.graph");function r(v){return{ladder:t,complete:function(e){if(!e||e<1)throw new Error("At least two nodes are expected for complete graph");var n,t,r=v();for(n=0;n<e;++n)for(t=n+1;t<e;++t)n!==t&&r.addLink(n,t);return r},completeBipartite:function(e,n){if(!e||!n||e<0||n<0)throw new Error("Graph dimensions are invalid. Number of nodes in each partition should be greater than 0");var t,r,o=v();for(t=0;t<e;++t)for(r=e;r<e+n;++r)o.addLink(t,r);return o},balancedBinTree:function(e){if(e<0)throw new Error("Invalid number of nodes in balanced tree");var n,t=v(),r=Math.pow(2,e);0===e&&t.addNode(1);for(n=1;n<r;++n){var o=n,i=2*o,a=2*o+1;t.addLink(o,i),t.addLink(o,a)}return t},path:function(e){if(!e||e<0)throw new Error("Invalid number of nodes");var n,t=v();for(t.addNode(0),n=1;n<e;++n)t.addLink(n-1,n);return t},circularLadder:function(e){if(!e||e<0)throw new Error("Invalid number of nodes");var n=t(e);return n.addLink(0,e-1),n.addLink(e,2*e-1),n},grid:function(e,n){if(e<1||n<1)throw new Error("Invalid number of nodes in grid graph");var t,r,o=v();if(1===e&&1===n)return o.addNode(0),o;for(t=0;t<e;++t)for(r=0;r<n;++r){var i=t+r*e;0<t&&o.addLink(i,t-1+r*e),0<r&&o.addLink(i,t+(r-1)*e)}return o},grid3:function(e,n,t){if(e<1||n<1||t<1)throw new Error("Invalid number of nodes in grid3 graph");var r,o,i,a=v();if(1===e&&1===n&&1===t)return a.addNode(0),a;for(i=0;i<t;++i)for(r=0;r<e;++r)for(o=0;o<n;++o){var s=i*e*n,u=r+o*e+s;0<r&&a.addLink(u,r-1+o*e+s),0<o&&a.addLink(u,r+(o-1)*e+s),0<i&&a.addLink(u,r+o*e+(i-1)*e*n)}return a},noLinks:function(e){if(e<0)throw new Error("Number of nodes should be >= 0");var n,t=v();for(n=0;n<e;++n)t.addNode(n);return t},wattsStrogatz:function(e,n,t,r){if(e<=n)throw new Error("Choose smaller `k`. It cannot be larger than number of nodes `n`");var o,i,a=h("ngraph.random").random(r||42),s=v();for(o=0;o<e;++o)s.addNode(o);for(var u=Math.floor(n/2+1),d=1;d<u;++d)for(o=0;o<e;++o)i=(d+o)%e,s.addLink(o,i);for(d=1;d<u;++d)for(o=0;o<e;++o)if(a.nextDouble()<t){var f=o;i=(d+o)%e;var c=a.next(e),l=c===f||s.hasLink(f,c);if(!l||s.getLinks(f).length!==e-1){for(;l;)c=a.next(e),l=c===f||s.hasLink(f,c);var p=s.hasLink(f,i);s.removeLink(p),s.addLink(f,c)}}return s},cliqueCircle:function(e,n){if(e<1)throw new Error("Invalid number of cliqueCount in cliqueCircle");if(n<1)throw new Error("Invalid number of cliqueSize in cliqueCircle");for(var o=v(),t=0;t<e;++t)!function(e,n){for(var t=0;t<e;++t)o.addNode(t+n);for(t=0;t<e;++t)for(var r=t+1;r<e;++r)o.addLink(t+n,r+n)}(n,t*n),0<t&&o.addLink(t*n,t*n-1);return o.addLink(0,o.getNodesCount()-1),o}};function t(e){if(!e||e<0)throw new Error("Invalid number of nodes");for(var n=v(),t=0;t<e-1;++t)n.addLink(t,t+1),n.addLink(e+t,e+t+1),n.addLink(t,e+t);return n.addLink(e-1,2*e-1),n}}e.exports=r(t),e.exports.factory=r},{"ngraph.graph":27,"ngraph.random":26}],26:[function(e,n,t){function r(e){return new o("number"==typeof e?e:+new Date)}function o(e){this.seed=e}function i(){var e=this.seed;return e=4294967295&(3042594569^(e=4251993797+(e=4294967295&(3550635116+(e=374761393+(e=4294967295&(3345072700^(e=e+2127912214+(e<<12)&4294967295)^e>>>19))+(e<<5)&4294967295)^e<<9))+(e<<3)&4294967295)^e>>>16),(268435455&(this.seed=e))/268435456}n.exports=r,n.exports.random=r,n.exports.randomIterator=function(o,e){var i=e||r();if("function"==typeof i.next)return{forEach:function(e){var n,t,r;for(n=o.length-1;0<n;--n)t=i.next(n+1),r=o[t],o[t]=o[n],o[n]=r,e(r);o.length&&e(o[0])},shuffle:function(){var e,n,t;for(e=o.length-1;0<e;--e)n=i.next(e+1),t=o[n],o[n]=o[e],o[e]=t;return o}};throw new Error("customRandom does not match expected API: next() function is missing")},o.prototype.next=function(e){return Math.floor(this.nextDouble()*e)},o.prototype.nextDouble=i,o.prototype.uniform=i,o.prototype.gaussian=function(){var e,n,t;for(;n=2*this.nextDouble()-1,t=2*this.nextDouble()-1,e=n*n+t*t,1<=e||0===e;);return n*Math.sqrt(-2*Math.log(e)/e)}},{}],27:[function(e,n,t){n.exports=function(e){"uniqueLinkId"in(e=e||{})&&(console.warn("ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\nUse `multigraph` option instead\n","\n","Note: there is also change in default behavior: From now own each graph\nis considered to be not a multigraph by default (each edge is unique)."),e.multigraph=e.uniqueLinkId);void 0===e.multigraph&&(e.multigraph=!1);var a="function"==typeof Object.create?Object.create(null):{},i=[],s={},o=0,n=0,t=Object.keys?_:j,u=e.multigraph?function(e,n,t){var r=S(e,n),o=s.hasOwnProperty(r);(o||w(e,n))&&(o||(s[r]=0),o="@"+ ++s[r],r=S(e+o,n+o));return new C(e,n,t,r)}:function(e,n,t){var r=S(e,n);return new C(e,n,t,r)},r=[],d=x,f=x,c=x,l=x,p={addNode:g,addLink:function(e,n,t){c();var r=m(e)||g(e),o=m(n)||g(n),t=u(e,n,t);i.push(t),I(r,t),e!==n&&I(o,t);return d(t,"add"),l(),t},removeLink:b,removeNode:y,getNode:m,getNodesCount:function(){return o},getLinksCount:function(){return i.length},getLinks:function(e){e=m(e);return e?e.links:null},forEachNode:t,forEachLinkedNode:function(e,n,t){var r=m(e);if(r&&r.links&&"function"==typeof n)return(t?function(e,n,t){for(var r=0;r<e.length;++r){var o=e[r];if(o.fromId===n&&t(a[o.toId],o))return!0}}:function(e,n,t){for(var r=0;r<e.length;++r){var o=e[r],i=o.fromId===n?o.toId:o.fromId;if(t(a[i],o))return!0}})(r.links,e,n)},forEachLink:function(e){var n,t;if("function"==typeof e)for(n=0,t=i.length;n<t;++n)e(i[n])},beginUpdate:c,endUpdate:l,clear:function(){c(),t(function(e){y(e.id)}),l()},hasLink:w,hasNode:m,getLink:w};return N(p),function(){var e=p.on;p.on=function(){return p.beginUpdate=c=E,p.endUpdate=l=L,d=v,f=h,(p.on=e).apply(p,arguments)}}(),p;function v(e,n){r.push({link:e,changeType:n})}function h(e,n){r.push({node:e,changeType:n})}function g(e,n){if(void 0===e)throw new Error("Invalid node identifier");c();var t=m(e);return t?(t.data=n,f(t,"update")):(t=new P(e,n),o++,f(t,"add")),a[e]=t,l(),t}function m(e){return a[e]}function y(e){var n=m(e);if(!n)return!1;c();var t=n.links;if(t){n.links=null;for(var r=0;r<t.length;++r)b(t[r])}return delete a[e],o--,f(n,"remove"),l(),!0}function b(e){if(!e)return!1;var n=k(e,i);if(n<0)return!1;c(),i.splice(n,1);var t=m(e.fromId),r=m(e.toId);return t&&0<=(n=k(e,t.links))&&t.links.splice(n,1),r&&0<=(n=k(e,r.links))&&r.links.splice(n,1),d(e,"remove"),l(),!0}function w(e,n){var t,r=m(e);if(!r||!r.links)return null;for(t=0;t<r.links.length;++t){var o=r.links[t];if(o.fromId===e&&o.toId===n)return o}return null}function x(){}function E(){n+=1}function L(){0===--n&&0<r.length&&(p.fire("changed",r),r.length=0)}function _(e){if("function"==typeof e)for(var n=Object.keys(a),t=0;t<n.length;++t)if(e(a[n[t]]))return!0}function j(e){if("function"==typeof e)for(var n in a)if(e(a[n]))return!0}};var N=e("ngraph.events");function k(e,n){if(!n)return-1;if(n.indexOf)return n.indexOf(e);for(var t=n.length,r=0;r<t;r+=1)if(n[r]===e)return r;return-1}function P(e,n){this.id=e,this.links=null,this.data=n}function I(e,n){e.links?e.links.push(n):e.links=[n]}function C(e,n,t,r){this.fromId=e,this.toId=n,this.data=t,this.id=r}function S(e,n){return e.toString()+"ðŸ‘‰ "+n.toString()}},{"ngraph.events":9}],28:[function(e,n,t){arguments[4][22][0].apply(t,arguments)},{dup:22}],29:[function(e,n,t){function r(e){function n(){return(268435455&(t=4294967295&(3042594569^(t=(t=4294967295&((t=(t=4294967295&(3345072700^(t=t+2127912214+(t<<12)&4294967295)^t>>>19))+374761393+(t<<5)&4294967295)+3550635116^t<<9))+4251993797+(t<<3)&4294967295)^t>>>16)))/268435456}var t="number"==typeof e?e:+new Date;return{next:function(e){return Math.floor(n()*e)},nextDouble:n}}n.exports={random:r,randomIterator:function(o,e){var i=e||r();if("function"==typeof i.next)return{forEach:function(e){for(var n,t,r=o.length-1;0<r;--r)n=i.next(r+1),t=o[n],o[n]=o[r],e(o[r]=t);o.length&&e(o[0])},shuffle:function(){for(var e,n,t=o.length-1;0<t;--t)e=i.next(t+1),n=o[e],o[e]=o[t],o[t]=n;return o}};throw new Error("customRandom does not match expected API: next() function is missing")}}},{}],30:[function(e,n,t){n.exports=function(e,n,t){var r={nodes:[],links:[]},o=n||function(e){var n={id:e.id};void 0!==e.data&&(n.data=e.data);return n},i=t||function(e){var n={fromId:e.fromId,toId:e.toId};void 0!==e.data&&(n.data=e.data);return n};return e.forEachNode(function(e){r.nodes.push(o(e))}),e.forEachLink(function(e){r.links.push(i(e))}),JSON.stringify(r)}},{}],31:[function(e,n,t){(n.exports=c).compile=e("./lib/compile");var s=c.compileTemplate=e("./lib/compile_template"),u=e("add-event-listener"),d="http://www.w3.org/2000/svg",f="http://www.w3.org/1999/xlink";function c(e,n){var t=function(e){var n,r=e;if("string"==typeof e)r=window.document.createElementNS(d,e);else if(e.simplesvg)return e;return r.simplesvg=!0,r.attr=function(e,n){if(2!==arguments.length)return r.getAttributeNS(null,e);null!==n?r.setAttributeNS(null,e,n):r.removeAttributeNS(null,e);return r},r.append=function(e){e=c(e);return r.appendChild(e),e},r.link=function(e){if(arguments.length)return r.setAttributeNS(f,"xlink:href",e),r;return r.getAttributeNS(f,"xlink:href")},r.text=function(e){return void 0===e?r.textContent:(r.textContent=e,r)},r.on=function(e,n,t){return u.addEventListener(r,e,n,t),r},r.off=function(e,n,t){return u.removeEventListener(r,e,n,t),r},r.dataSource=function(e){n=n||s(r);return n.link(e),r},r}(e);if(void 0===n)return t;for(var r=Object.keys(n),o=0;o<r.length;++o){var i=r[o],a=n[i];"link"===i?t.link(a):t.attr(i,a)}return t}},{"./lib/compile":32,"./lib/compile_template":33,"add-event-listener":2}],32:[function(e,n,t){var r=e("./domparser.js"),o=e("../");n.exports=function(e){try{return e=function(e){if(!e)return;var n=e.match(/^<\w+/);{if(n){n=n[0].length;return e.substr(0,n)+' xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" '+e.substr(n)}throw new Error("Cannot parse input text: invalid xml?")}}(e),o(r.parseFromString(e,"text/xml").documentElement)}catch(e){throw e}}},{"../":31,"./domparser.js":34}],33:[function(e,n,t){n.exports=function(e){var r=Object.create(null);return function e(n,t){var r=n.nodeType;var o=1===r||3===r;if(!o)return;var i;if(n.hasChildNodes()){var a=n.childNodes;for(i=0;i<a.length;++i)e(a[i],t)}3===r&&d(n,t);if(!n.attributes)return;var s=n.attributes;for(i=0;i<s.length;++i)u(s[i],n,t)}(e,r),{link:function(n){function t(e){e(n)}Object.keys(r).forEach(function(e){r[e].forEach(t)})}}};var s=/{{(.+?)}}/;function u(e,n,t){var r=e.value;if(r){r=r.match(s);if(r){var o=e.localName,i=r[1];if(!(i.indexOf(".")<0))throw new Error("simplesvg currently does not support nested bindings");r=t[i];r?r.push(a):r=t[i]=[a]}}function a(e){n.setAttributeNS(null,o,e[i])}}function d(n,e){var t,r=n.nodeValue;function o(e){n.nodeValue=e[t]}!r||(r=r.match(s))&&((t=r[1]).indexOf("."),(r=e[t])?r.push(o):r=e[t]=[o])}},{}],34:[function(e,n,t){function r(){throw new Error("DOMParser is not supported by this platform. Please open issue here https://github.com/anvaka/simplesvg")}n.exports="undefined"!=typeof DOMParser?new DOMParser:{parseFromString:r}},{}],35:[function(e,n,t){var r=e("ngraph.centrality");function o(e){return a(r.betweenness(e))}function i(e,n){return a(r.degree(e,n))}function a(t){return Object.keys(t).sort(function(e,n){return t[n]-t[e]}).map(function(e){return{key:e,value:t[e]}})}n.exports=function(){return{betweennessCentrality:o,degreeCentrality:i}}},{"ngraph.centrality":4}],36:[function(e,n,t){n.exports=function(){return{density:function(e,n){var t=e.getNodesCount();return 0===t?NaN:n?e.getLinksCount()/(t*(t-1)):2*e.getLinksCount()/(t*(t-1))}}}},{}],37:[function(e,n,t){n.exports=function(e,r){var o={};return{bindDragNDrop:function(e,n){{var t;n?(t=r.getNodeUI(e.id),t=i(t),"function"==typeof n.onStart&&t.onStart(n.onStart),"function"==typeof n.onDrag&&t.onDrag(n.onDrag),"function"==typeof n.onStop&&t.onStop(n.onStop),o[e.id]=t):(t=o[e.id])&&(t.release(),delete o[e.id])}}}};var i=e("./dragndrop.js")},{"./dragndrop.js":38}],38:[function(e,n,t){n.exports=function(i){function r(e,n,t){p&&p(e,{x:n-b,y:t-w}),b=n,w=t}function o(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function a(e){e.preventDefault&&e.preventDefault()}function n(e){return o(e),!1}function t(e){e=e||window.event,r(e,e.clientX,e.clientY)}function e(e){return e=e||window.event,x?(o(e),!1):1===e.button&&null!==window.event||0===e.button?(b=e.clientX,w=e.clientY,y=e.target||e.srcElement,l&&l(e,{x:b,y:w}),j.on("mousemove",t),j.on("mouseup",L),o(e),g=window.document.onselectstart,m=window.document.ondragstart,window.document.onselectstart=n,y.ondragstart=n,!1):void 0}function s(e){var n,t,r,o;"function"==typeof h&&((e=e||window.event).preventDefault&&e.preventDefault(),e.returnValue=!1,n=-e.deltaY,o=r=0,(t=(t=e)||window.event).pageX||t.pageY?(r=t.pageX,o=t.pageY):(t.clientX||t.clientY)&&(r=t.clientX+window.document.body.scrollLeft+window.document.documentElement.scrollLeft,o=t.clientY+window.document.body.scrollTop+window.document.documentElement.scrollTop),r=[r,o],o=N(i),o={x:r[0]-o[0],y:r[1]-o[1]},h(e,n,o))}function u(e){!h&&e?i.addEventListener("wheel",s,!1):h&&!e&&i.removeEventListener("wheel",s,!1),h=e}function d(e,n){return(e.clientX-n.clientX)*(e.clientX-n.clientX)+(e.clientY-n.clientY)*(e.clientY-n.clientY)}function f(e){var n,t;1===e.touches.length?(o(e),n=e.touches[0],r(e,n.clientX,n.clientY)):2===e.touches.length&&(t=0,(n=d(e.touches[0],e.touches[1]))<E?t=-1:E<n&&(t=1),h(e,t,{x:e.touches[0].clientX,y:e.touches[0].clientY}),E=n,o(e),a(e))}function c(e){if(1===e.touches.length)return t=(n=e).touches[0],o(n),a(n),b=t.clientX,w=t.clientY,y=n.target||n.srcElement,l&&l(n,{x:b,y:w}),void(x||(x=!0,j.on("touchmove",f),j.on("touchend",_),j.on("touchcancel",_)));var n,t;2===e.touches.length&&(o(e),a(e),E=d(e.touches[0],e.touches[1]))}var l,p,v,h,g,m,y,b=0,w=0,x=!1,E=0,L=function(e){e=e||window.event,j.off("mousemove",t),j.off("mouseup",L),window.document.onselectstart=g,y.ondragstart=m,y=null,v&&v(e)},_=function(e){x=!1,j.off("touchmove",f),j.off("touchend",_),j.off("touchcancel",_),y=null,v&&v(e)};return i.addEventListener("mousedown",e),i.addEventListener("touchstart",c),{onStart:function(e){return l=e,this},onDrag:function(e){return p=e,this},onStop:function(e){return v=e,this},onScroll:function(e){return u(e),this},release:function(){i.removeEventListener("mousedown",e),i.removeEventListener("touchstart",c),j.off("mousemove",t),j.off("mouseup",L),j.off("touchmove",f),j.off("touchend",_),j.off("touchcancel",_),u(null)}}};var j=e("../Utils/documentEvents.js"),N=(e("../Utils/browserInfo.js"),e("../Utils/findElementPosition.js"))},{"../Utils/browserInfo.js":42,"../Utils/documentEvents.js":43,"../Utils/findElementPosition.js":44}],39:[function(e,n,t){n.exports=function(e,n){var t=a(n),r=null,o={},i={x:0,y:0};return t.mouseDown(function(e,n){r=e,i.x=n.clientX,i.y=n.clientY,t.mouseCapture(r);e=o[e.id];return e&&e.onStart&&e.onStart(n,i),!0}).mouseUp(function(e){t.releaseMouseCapture(r),r=null;e=o[e.id];return e&&e.onStop&&e.onStop(),!0}).mouseMove(function(e,n){if(r){var t=o[r.id];return t&&t.onDrag&&t.onDrag(n,{x:n.clientX-i.x,y:n.clientY-i.y}),i.x=n.clientX,i.y=n.clientY,!0}}),{bindDragNDrop:function(e,n){(o[e.id]=n)||delete o[e.id]}}};var a=e("../WebGL/webglInputEvents.js")},{"../WebGL/webglInputEvents.js":60}],40:[function(e,n,t){n.exports=function(e,n){n=l(n,{maxX:1024,maxY:1024,seed:"Deterministic randomness made me do this"});function r(e){var n;f[e.id]=d(e),n=f[e.id],e=s,n.x<e.x1&&(e.x1=n.x),n.x>e.x2&&(e.x2=n.x),n.y<e.y1&&(e.y1=n.y),n.y>e.y2&&(e.y2=n.y)}function t(){0!==e.getNodesCount()&&(s.x1=Number.MAX_VALUE,s.y1=Number.MAX_VALUE,s.x2=Number.MIN_VALUE,s.y2=Number.MIN_VALUE,e.forEachNode(r))}function o(e){u[e.id]=e}function i(e){for(var n=0;n<e.length;++n){var t=e[n];t.node&&("add"===t.changeType?r(t.node):delete f[t.node.id]),t.link&&("add"===t.changeType?o(t.link):delete u[t.link.id])}}var a=p(n.seed),s=new v(Number.MAX_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,Number.MIN_VALUE),u={},d=function(e){return{x:a.next(n.maxX),y:a.next(n.maxY)}},f="function"==typeof Object.create?Object.create(null):{};return e.forEachNode(r),e.forEachLink(o),e.on("changed",i),{run:function(e){this.step()},step:function(){return t(),!0},getGraphRect:function(){return s},dispose:function(){e.off("change",i)},isNodePinned:function(e){return!0},pinNode:function(e,n){},getNodePosition:c,getLinkPosition:function(e){e=u[e];return{from:c(e.fromId),to:c(e.toId)}},setNodePosition:function(e,n,t){e=f[e];e&&(e.x=n,e.y=t)},placeNode:function(e){return"function"==typeof e?(d=e,t(),this):d(e)}};function c(e){return f[e]}};var l=e("ngraph.merge"),p=e("ngraph.random").random,v=e("../Utils/rect.js")},{"../Utils/rect.js":48,"ngraph.merge":28,"ngraph.random":29}],41:[function(e,n,t){var r=e("ngraph.events");n.exports=function(n){return console.log("This method is deprecated. Please use Viva.events() instead"),n&&(void 0===n.on&&void 0===n.off&&void 0===n.fire?{extend:function(){var e=r(n);return e.addEventListener=e.on,e},on:n.on,stop:n.off}:{extend:function(){return n},on:n.on,stop:n.off})}},{"ngraph.events":9}],42:[function(e,n,t){n.exports=function(){if("undefined"==typeof window||!window.hasOwnProperty("navigator"))return{browser:"",version:"0"};var e=window.navigator.userAgent.toLowerCase(),e=/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(e)||[];return{browser:e[1]||"",version:e[2]||"0"}}()},{}],43:[function(e,n,t){e("./nullEvents.js");function r(e,n){document.addEventListener(e,n)}function o(e,n){document.removeEventListener(e,n)}n.exports={on:r,off:o}},{"./nullEvents.js":47}],44:[function(e,n,t){n.exports=function(e){var n=0,t=0;if(e.offsetParent)for(;n+=e.offsetLeft,t+=e.offsetTop,null!==(e=e.offsetParent););return[n,t]}},{}],45:[function(e,n,t){n.exports=function(e){if(!e)throw{message:"Cannot get dimensions of undefined container"};var n=e.clientWidth,e=e.clientHeight;return{left:0,top:0,width:n,height:e}}},{}],46:[function(e,n,t){var u=e("gintersect");n.exports=function(e,n,t,r,o,i,a,s){return u(e,n,e,r,o,i,a,s)||u(e,r,t,r,o,i,a,s)||u(t,r,t,n,o,i,a,s)||u(t,n,e,n,o,i,a,s)}},{gintersect:3}],47:[function(e,n,t){function r(){}n.exports={on:r,off:r,stop:r}},{}],48:[function(e,n,t){n.exports=function(e,n,t,r){this.x1=e||0,this.y1=n||0,this.x2=t||0,this.y2=r||0}},{}],49:[function(e,n,t){!function(r){function a(){}n.exports=function(){var e,o,i=0,n=["ms","moz","webkit","o"];o="undefined"!=typeof window?window:void 0!==r?r:{setTimeout:a,clearTimeout:a};for(e=0;e<n.length&&!o.requestAnimationFrame;++e){var t=n[e];o.requestAnimationFrame=o[t+"RequestAnimationFrame"],o.cancelAnimationFrame=o[t+"CancelAnimationFrame"]||o[t+"CancelRequestAnimationFrame"]}o.requestAnimationFrame||(o.requestAnimationFrame=function(e){var n=(new Date).getTime(),t=Math.max(0,16-(n-i)),r=o.setTimeout(function(){e(n+t)},t);return i=n+t,r});o.cancelAnimationFrame||(o.cancelAnimationFrame=function(e){o.clearTimeout(e)});return function(e){var n;return t(),{stop:r,restart:function(){n||t()}};function t(){n=o.requestAnimationFrame(t),e()||r()}function r(){o.cancelAnimationFrame(n),n=0}}}()}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],50:[function(e,n,t){var r=e("./nullEvents.js");function o(e,n){window.addEventListener(e,n)}function i(e,n){window.removeEventListener(e,n)}n.exports="undefined"!=typeof window?{on:o,off:i}:r},{"./nullEvents.js":47}],51:[function(e,n,t){n.exports=function(i,a){var t,r,o,s=(a=a||{}).layout,u=a.graphics,d=a.container,n=void 0===a.interactive||a.interactive,f=!1,c=!0,e=!1,l=!1,p=!1,v={offsetX:0,offsetY:0,scale:1},h=A({});return{run:function(e){var n;return f||(d=d||window.document.body,s=s||T(i,{springLength:80,springCoeff:2e-4}),u=u||B(i,{container:d}),a.hasOwnProperty("renderLinks")||(a.renderLinks=!0),a.prerender=a.prerender||0,t=(u.inputManager||$)(i,u),function(){if("number"==typeof a.prerender&&0<a.prerender)for(var e=0;e<a.prerender;e+=1)s.step()}(),u.init(d),i.forEachNode(x),a.renderLinks&&i.forEachLink(L),w(),M.on("resize",P),I(),g("drag")&&(o=R(d)).onDrag(function(e,n){u.translateRel(n.x,n.y),m(),h.fire("drag",n)}),g("scroll")&&(o=o||R(d)).onScroll(function(e,n,t){S(n<0,t)}),i.forEachNode(j),C(),i.on("changed",k),f=!0),n=e,r=r||D(void 0!==n?function(){if(--n<0)return!1;return y()}:y,30),this},reset:function(){u.resetScale(),w(),v.scale=1},pause:function(){p=!0,r.stop()},resume:function(){p=!1,r.restart()},rerender:function(){return m(),this},zoomOut:function(){return S(!0)},zoomIn:function(){return S(!1)},getTransform:function(){return v},moveTo:function(e,n){u.graphCenterChanged(v.offsetX-e*v.scale,v.offsetY-n*v.scale),m()},getGraphics:function(){return u},getLayout:function(){return s},dispose:function(){f=!1,C(),I(),M.off("resize",P),h.off(),r.stop(),i.forEachLink(function(e){a.renderLinks&&_(e)}),i.forEachNode(function(e){N(e),E(e)}),s.dispose(),u.release(d)},on:function(e,n){return h.on(e,n),this},off:function(e,n){return h.off(e,n),this}};function g(e){return"string"==typeof n?0<=n.indexOf(e):"boolean"!=typeof n||n}function m(){u.beginRender(),a.renderLinks&&u.renderLinks(),u.renderNodes(),u.endRender()}function y(){return e=s.step()&&!l,m(),!e}function b(){p||(e=!1,r.restart())}function w(){var e=s.getGraphRect(),n=F(d),t=(e.x2+e.x1)/2,e=(e.y2+e.y1)/2;v.offsetX=n.width/2-(t*v.scale-t),v.offsetY=n.height/2-(e*v.scale-e),u.graphCenterChanged(v.offsetX,v.offsetY),c=!1}function x(e){var n=s.getNodePosition(e.id);u.addNode(e,n)}function E(e){u.releaseNode(e)}function L(e){var n=s.getLinkPosition(e.id);u.addLink(e,n)}function _(e){u.releaseLink(e)}function j(r){var e;g("node")&&(e=!1,t.bindDragNDrop(r,{onStart:function(){e=s.isNodePinned(r),s.pinNode(r,!0),l=!0,b()},onDrag:function(e,n){var t=s.getNodePosition(r.id);s.setNodePosition(r.id,t.x+n.x/v.scale,t.y+n.y/v.scale),l=!0,m()},onStop:function(){s.pinNode(r,e),l=!1}}))}function N(e){t.bindDragNDrop(e,null)}function k(e){for(var n,t,r,o=0;o<e.length;o+=1)(n=e[o]).node?(r=void 0,r=(t=n).node,"add"===t.changeType?(x(r),j(r),c&&w()):"remove"===t.changeType?(N(r),E(r),0===i.getNodesCount()&&(c=!0)):"update"===t.changeType&&(N(r),E(r),x(r),j(r))):n.link&&function(e){var n=e.link;if("add"===e.changeType)a.renderLinks&&L(n);else if("remove"===e.changeType)a.renderLinks&&_(n);else if("update"===e.changeType)throw"Update type is not implemented. TODO: Implement me!"}(n);b()}function P(){w(),y()}function I(){o&&(o.release(),o=null)}function C(){i.off("changed",k)}function S(e,n){var t;n||(n={x:(t=F(d)).width/2,y:t.height/2});e=Math.pow(1.4,e?-.2:.2);return v.scale=u.scale(e,n),m(),h.fire("scale",v.scale),v.scale}};var A=e("ngraph.events"),T=e("ngraph.forcelayout"),B=e("./svgGraphics.js"),M=e("../Utils/windowEvents.js"),$=e("../Input/domInputManager.js"),D=e("../Utils/timer.js"),F=e("../Utils/getDimensions.js"),R=e("../Input/dragndrop.js")},{"../Input/domInputManager.js":37,"../Input/dragndrop.js":38,"../Utils/getDimensions.js":45,"../Utils/timer.js":49,"../Utils/windowEvents.js":50,"./svgGraphics.js":52,"ngraph.events":9,"ngraph.forcelayout":10}],52:[function(e,n,t){n.exports=function(){function r(e){e.fire("rescaled")}function t(){var e;i&&(e="matrix("+u+", 0, 0,"+u+","+o+","+s+")",i.attr("transform",e))}var i,a,n,o=0,s=0,u=1,d={},f={},c=function(e){return y("rect").attr("width",10).attr("height",10).attr("fill","#00a2e8")},l=function(e,n){e.attr("x",n.x-5).attr("y",n.y-5)},p=function(e){return y("line").attr("stroke","#999")},v=function(e,n,t){e.attr("x1",n.x).attr("y1",n.y).attr("x2",t.x).attr("y2",t.y)},h={x:0,y:0},g={x:0,y:0},m={x:0,y:0};a=function(){var e=y("svg");return i=y("g").attr("buffered-rendering","dynamic"),e.appendChild(i),e}();var e={getNodeUI:function(e){return d[e]},getLinkUI:function(e){return f[e]},node:function(e){if("function"==typeof e)return c=e,this},link:function(e){if("function"==typeof e)return p=e,this},placeNode:function(e){return l=e,this},placeLink:function(e){return v=e,this},beginRender:function(){},endRender:function(){},graphCenterChanged:function(e,n){o=e,s=n,t()},inputManager:w,translateRel:function(e,n){var t=a.createSVGPoint(),r=i.getCTM(),o=a.createSVGPoint().matrixTransform(r.inverse());t.x=e,t.y=n,(t=t.matrixTransform(r.inverse())).x=(t.x-o.x)*r.a,t.y=(t.y-o.y)*r.d,r.e+=t.x,r.f+=t.y;r="matrix("+r.a+", 0, 0,"+r.d+","+r.e+","+r.f+")";i.attr("transform",r)},scale:function(e,n){(t=a.createSVGPoint()).x=n.x,t.y=n.y;var t=t.matrixTransform(i.getCTM().inverse()),t=a.createSVGMatrix().translate(t.x,t.y).scale(e).translate(-t.x,-t.y),t=i.getCTM().multiply(t);u=t.a,o=t.e,s=t.f;t="matrix("+t.a+", 0, 0,"+t.d+","+t.e+","+t.f+")";return i.attr("transform",t),r(this),u},resetScale:function(){u=1;return i.attr("transform","matrix(1, 0, 0, 1, 0, 0)"),r(this),this},init:function(e){e.appendChild(a),t(),"function"==typeof n&&n(a)},release:function(e){a&&e&&e.removeChild(a)},addLink:function(e,n){var t=p(e);if(t)return t.position=n,t.link=e,f[e.id]=t,0<i.childElementCount?i.insertBefore(t,i.firstChild):i.appendChild(t),t},releaseLink:function(e){var n=f[e.id];n&&(i.removeChild(n),delete f[e.id])},addNode:function(e,n){var t=c(e);if(t)return t.position=n,t.node=e,d[e.id]=t,i.appendChild(t),t},releaseNode:function(e){var n=d[e.id];n&&(i.removeChild(n),delete d[e.id])},renderNodes:function(){for(var e in d)d.hasOwnProperty(e)&&(e=d[e],h.x=e.position.x,h.y=e.position.y,l(e,h,e.node))},renderLinks:function(){for(var e in f)f.hasOwnProperty(e)&&(e=f[e],g.x=e.position.from.x,g.y=e.position.from.y,m.x=e.position.to.x,m.y=e.position.to.y,v(e,g,m,e.link))},getGraphicsRoot:function(e){return"function"==typeof e&&(a?e(a):n=e),a},getSvgRoot:function(){return a}};return b(e),e};var y=e("simplesvg"),b=e("ngraph.events"),w=e("../Input/domInputManager.js")},{"../Input/domInputManager.js":37,"ngraph.events":9,simplesvg:31}],53:[function(e,n,t){n.exports=function(r){r=A(r,{enableBlending:!0,preserveDrawingBuffer:!1,clearColor:!1,clearColorValue:{r:1,g:1,b:1,a:1}});function o(){E.updateTransform(m),L.updateTransform(m)}function i(){m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function a(){s&&u&&(f=u.width=Math.max(s.offsetWidth,1),c=u.height=Math.max(s.offsetHeight,1),d&&d.viewport(0,0,f,c),E&&E.updateSize(f/2,c/2),L&&L.updateSize(f/2,c/2))}var s,u,d,f,c,l,p,v,h=0,g=0,m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],y=[],b=[],w={},x={},E=k(),L=P(),_=function(e){return I()},j=function(e){return C(3014898687)};u=window.document.createElement("canvas");var e={getLinkUI:function(e){return x[e]},getNodeUI:function(e){return w[e]},node:function(e){if("function"==typeof e)return _=e,this},link:function(e){if("function"==typeof e)return j=e,this},placeNode:function(e){return l=e,this},placeLink:function(e){return p=e,this},inputManager:N,beginRender:function(){},endRender:function(){0<g&&E.render(),0<h&&L.render()},bringLinkToFront:function(e){var n,t=E.getFrontLinkId();E.bringToFront(e),t>e.id&&(n=e.id,e=b[t],b[t]=b[n],b[t].id=t,b[n]=e,b[n].id=n)},graphCenterChanged:function(e,n){m[12]=2*e/f-1,m[13]=1-2*n/c,o()},addLink:function(e,n){var t=g++,r=j(e);return r.id=t,r.pos=n,E.createLink(r),b[t]=r,x[e.id]=r},addNode:function(e,n){var t=h++,r=_(e);return r.id=t,r.position=n,r.node=e,L.createNode(r),y[t]=r,w[e.id]=r},translateRel:function(e,n){m[12]+=2*m[0]*e/f/m[0],m[13]-=2*m[5]*n/c/m[5],o()},scale:function(e,n){var t=2*n.x/f-1,n=1-2*n.y/c;return t-=m[12],n-=m[13],m[12]+=t*(1-e),m[13]+=n*(1-e),m[0]*=e,m[5]*=e,o(),this.fire("rescaled"),m[0]},resetScale:function(){return i(),d&&(a(),o()),this},updateSize:a,init:function(e){var n={};if(r.preserveDrawingBuffer&&(n.preserveDrawingBuffer=!0),s=e,a(),i(),s.appendChild(u),!(d=u.getContext("experimental-webgl",n))){var t="Could not initialize WebGL. Seems like the browser doesn't support it.";throw window.alert(t),t}r.enableBlending&&(d.blendFunc(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA),d.enable(d.BLEND)),r.clearColor&&(t=r.clearColorValue,d.clearColor(t.r,t.g,t.b,t.a),this.beginRender=function(){d.clear(d.COLOR_BUFFER_BIT)}),E.load(d),E.updateSize(f/2,c/2),L.load(d),L.updateSize(f/2,c/2),o(),"function"==typeof v&&v(u)},release:function(e){u&&e&&e.removeChild(u)},isSupported:function(){var e=window.document.createElement("canvas");return e&&e.getContext&&e.getContext("experimental-webgl")},releaseLink:function(e){0<g&&--g;var n=x[e.id];delete x[e.id],E.removeLink(n);e=n.id;e<g&&0!==g&&g!==e&&(n=b[g],(b[e]=n).id=e)},releaseNode:function(e){0<h&&--h;var n=w[e.id];delete w[e.id],L.removeNode(n);var t=n.id;t<h&&0!==h&&h!==t&&(e=y[h],(y[t]=e).id=t,L.replaceProperties(n,e))},renderNodes:function(){for(var e={x:0,y:0},n=0;n<h;++n){var t=y[n];e.x=t.position.x,e.y=t.position.y,l&&l(t,e),L.position(t,e)}},renderLinks:function(){if(!this.omitLinksRendering)for(var e={x:0,y:0},n={x:0,y:0},t=0;t<g;++t){var r=b[t],o=r.pos.from;n.x=o.x,n.y=-o.y,o=r.pos.to,e.x=o.x,e.y=-o.y,p&&p(r,n,e),E.position(r,n,e)}},getGraphicsRoot:function(e){return"function"==typeof e&&(u?e(u):v=e),u},setNodeProgram:function(e){if(!d&&e)L=e;else if(e)throw"Not implemented. Cannot swap shader on the fly... Yet."},setLinkProgram:function(e){if(!d&&e)E=e;else if(e)throw"Not implemented. Cannot swap shader on the fly... Yet."},transformClientToGraphCoordinates:function(e){return e.x=2*e.x/f-1,e.y=1-2*e.y/c,e.x=(e.x-m[12])/m[0],e.y=(e.y-m[13])/m[5],e.x=e.x*(f/2),e.y=e.y*(-c/2),e},transformGraphToClientCoordinates:function(e){return e.x=e.x/(f/2),e.y=e.y/(-c/2),e.x=e.x*m[0]+m[12],e.y=e.y*m[5]+m[13],e.x=(e.x+1)*f/2,e.y=(1-e.y)*c/2,e},getNodeAtClientPos:function(e,n){if("function"!=typeof n)return null;this.transformClientToGraphCoordinates(e);for(var t=0;t<h;++t)if(n(y[t],e.x,e.y))return y[t].node;return null}};return S(e),e};var N=e("../Input/webglInputManager.js"),k=e("../WebGL/webglLinkProgram.js"),P=e("../WebGL/webglNodeProgram.js"),I=e("../WebGL/webglSquare.js"),C=e("../WebGL/webglLine.js"),S=e("ngraph.events"),A=e("ngraph.merge")},{"../Input/webglInputManager.js":39,"../WebGL/webglLine.js":61,"../WebGL/webglLinkProgram.js":62,"../WebGL/webglNodeProgram.js":63,"../WebGL/webglSquare.js":64,"ngraph.events":9,"ngraph.merge":28}],54:[function(e,n,t){n.exports=function(e){var n=10414335;if("string"==typeof e&&e)if(9===(e=4===e.length?e.replace(/([^#])/g,"$1$1"):e).length)n=parseInt(e.substr(1),16);else{if(7!==e.length)throw'Color expected in hex format with preceding "#". E.g. #00ff00. Got value: '+e;n=parseInt(e.substr(1),16)<<8|255}else"number"==typeof e&&(n=e);return n}},{}],55:[function(e,n,t){n.exports=function(e){this.canvas=window.document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.isDirty=!1,this.canvas.width=this.canvas.height=e}},{}],56:[function(e,n,t){function o(e,n,t,r){for(var o=0;o<r;++o)e[n+o]=e[t+o]}function i(e,n,t,r){for(var o=0;o<r;++o){var i=e[n+o];e[n+o]=e[t+o],e[t+o]=i}}n.exports=function(a){return{createProgram:function(e,n){var t=a.createProgram(),e=r(e,a.VERTEX_SHADER),n=r(n,a.FRAGMENT_SHADER);if(a.attachShader(t,e),a.attachShader(t,n),a.linkProgram(t),a.getProgramParameter(t,a.LINK_STATUS))return t;t=a.getShaderInfoLog(t);throw window.alert(t),t},extendArray:function(e,n,t){if((n+1)*t>e.length){t=new Float32Array(e.length*t*2);return t.set(e),t}return e},copyArrayPart:o,swapArrayPart:i,getLocations:function(e,n){for(var t={},r=0;r<n.length;++r){var o=n[r],i=-1;if("a"===o[0]&&"_"===o[1]){if(-1===(i=a.getAttribLocation(e,o)))throw new Error("Program doesn't have required attribute: "+o);t[o.slice(2)]=i}else{if("u"!==o[0]||"_"!==o[1])throw new Error("Couldn't figure out your intent. All uniforms should start with 'u_' prefix, and attributes with 'a_'");if(null===(i=a.getUniformLocation(e,o)))throw new Error("Program doesn't have required uniform: "+o);t[o.slice(2)]=i}}return t},context:a};function r(e,n){n=a.createShader(n);if(a.shaderSource(n,e),a.compileShader(n),a.getShaderParameter(n,a.COMPILE_STATUS))return n;n=a.getShaderInfoLog(n);throw window.alert(n),n}}},{}],57:[function(e,n,t){var p=e("./texture.js");n.exports=function(t){var e,a=Math.sqrt(t||1024)<<0,s=a,o=1,u={},n=0,d=[],f=[];if(!function(e){return 0==(e&e-1)}(t))throw"Tiles per texture should be power of two.";var r={isDirty:!1,clearDirty:function(){var e;for(r.isDirty=!1,e=0;e<d.length;++e)d[e].isDirty=!1},remove:function(e){var n=u[e];if(!n)return!1;if(delete u[e],--o===n.offset)return!0;e=c(n.offset);return function(e,n){var t=d[e.textureNumber].canvas,r=d[n.textureNumber].ctx,o=n.col*s,i=n.row*s;r.drawImage(t,e.col*s,e.row*s,s,s,o,i,s,s),d[e.textureNumber].isDirty=!0,d[n.textureNumber].isDirty=!0}(c(o),e),u[f[o]].offset=n.offset,f[n.offset]=f[o],l(),!0},getTextures:function(){return d},getCoordinates:function(e){return u[e]},load:function(e,n){{var t,r;u.hasOwnProperty(e)?n(u[e]):(t=new window.Image,r=o,o+=1,t.crossOrigin="anonymous",t.onload=function(){l(),function(e,n,t){var r=c(e),o={offset:e};r.textureNumber>=d.length&&function(){var e=new p(a*s);d.push(e)}();var i=d[r.textureNumber];i.ctx.drawImage(n,r.col*s,r.row*s,s,s),f[e]=n.src,u[n.src]=o,i.isDirty=!0,t(o)}(r,t,n)},t.src=e)}}};return r;function c(e){var n=e%t;return{textureNumber:e/t<<0,row:n/a<<0,col:n%a}}function i(){r.isDirty=!0,n=0,e=null}function l(){e&&(window.clearTimeout(e),n+=1,e=null),10<n?i():e=window.setTimeout(i,400)}}},{"./texture.js":55}],58:[function(e,n,t){n.exports=function(e,n){return{_texture:0,_offset:0,size:"number"==typeof e?e:32,src:n}}},{}],59:[function(e,n,t){var g=e("./webglAtlas.js"),m=e("./webgl.js");n.exports=function(n){var t,r,o,i,a,s,u,d,f,c,l=["precision mediump float;","varying vec4 color;","varying vec3 vTextureCoord;","uniform sampler2D u_sampler0;","uniform sampler2D u_sampler1;","uniform sampler2D u_sampler2;","uniform sampler2D u_sampler3;","void main(void) {","   if (vTextureCoord.z == 0.) {","     gl_FragColor = texture2D(u_sampler0, vTextureCoord.xy);","   } else if (vTextureCoord.z == 1.) {","     gl_FragColor = texture2D(u_sampler1, vTextureCoord.xy);","   } else if (vTextureCoord.z == 2.) {","     gl_FragColor = texture2D(u_sampler2, vTextureCoord.xy);","   } else if (vTextureCoord.z == 3.) {","     gl_FragColor = texture2D(u_sampler3, vTextureCoord.xy);","   } else { gl_FragColor = vec4(0, 1, 0, 1); }","}"].join("\n"),p=["attribute vec2 a_vertexPos;","attribute float a_customAttributes;","uniform vec2 u_screenSize;","uniform mat4 u_transform;","uniform float u_tilesPerTexture;","varying vec3 vTextureCoord;","void main(void) {","   gl_Position = u_transform * vec4(a_vertexPos/u_screenSize, 0, 1);","float corner = mod(a_customAttributes, 4.);","float tileIndex = mod(floor(a_customAttributes / 4.), u_tilesPerTexture);","float tilesPerRow = sqrt(u_tilesPerTexture);","float tileSize = 1./tilesPerRow;","float tileColumn = mod(tileIndex, tilesPerRow);","float tileRow = floor(tileIndex/tilesPerRow);","if(corner == 0.0) {","  vTextureCoord.xy = vec2(0, 1);","} else if(corner == 1.0) {","  vTextureCoord.xy = vec2(1, 1);","} else if(corner == 2.0) {","  vTextureCoord.xy = vec2(0, 0);","} else {","  vTextureCoord.xy = vec2(1, 0);","}","vTextureCoord *= tileSize;","vTextureCoord.x += tileColumn * tileSize;","vTextureCoord.y += tileRow * tileSize;","vTextureCoord.z = floor(floor(a_customAttributes / 4.)/u_tilesPerTexture);","}"].join("\n"),n=n||1024,v=0,h=new Float32Array(64);return{load:function(e){a=m(o=e),t=new g(n),r=a.createProgram(p,l),o.useProgram(r),s=a.getLocations(r,["a_vertexPos","a_customAttributes","u_screenSize","u_transform","u_sampler0","u_sampler1","u_sampler2","u_sampler3","u_tilesPerTexture"]),o.uniform1f(s.tilesPerTexture,n),o.enableVertexAttribArray(s.vertexPos),o.enableVertexAttribArray(s.customAttributes),i=o.createBuffer()},position:function(e,n){var t=18*e.id;h[t]=n.x-e.size,h[1+t]=-n.y-e.size,h[2+t]=4*e._offset,h[3+t]=n.x+e.size,h[4+t]=-n.y-e.size,h[5+t]=4*e._offset+1,h[6+t]=n.x-e.size,h[7+t]=-n.y+e.size,h[8+t]=4*e._offset+2,h[9+t]=n.x-e.size,h[10+t]=-n.y+e.size,h[11+t]=4*e._offset+2,h[12+t]=n.x+e.size,h[13+t]=-n.y-e.size,h[14+t]=4*e._offset+1,h[15+t]=n.x+e.size,h[16+t]=-n.y+e.size,h[17+t]=4*e._offset+3},createNode:function(n){h=a.extendArray(h,v,18),v+=1;var e=t.getCoordinates(n.src);e?n._offset=e.offset:(n._offset=0,t.load(n.src,function(e){n._offset=e.offset}))},removeNode:function(e){0<v&&--v;e.id<v&&0<v&&(e.src&&t.remove(e.src),a.copyArrayPart(h,18*e.id,18*v,18))},replaceProperties:function(e,n){n._offset=e._offset},updateTransform:function(e){c=!0,f=e},updateSize:function(e,n){u=e,d=n,c=!0},render:function(){o.useProgram(r),o.bindBuffer(o.ARRAY_BUFFER,i),o.bufferData(o.ARRAY_BUFFER,h,o.DYNAMIC_DRAW),c&&(c=!1,o.uniformMatrix4fv(s.transform,!1,f),o.uniform2f(s.screenSize,u,d));o.vertexAttribPointer(s.vertexPos,2,o.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0),o.vertexAttribPointer(s.customAttributes,1,o.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,8),function(){if(t.isDirty){var e,n=t.getTextures();for(e=0;e<n.length;++e)!n[e].isDirty&&n[e].nativeObject||function(e,n){e.nativeObject&&o.deleteTexture(e.nativeObject);var t=o.createTexture();o.activeTexture(o["TEXTURE"+n]),o.bindTexture(o.TEXTURE_2D,t),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,e.canvas),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR_MIPMAP_NEAREST),o.generateMipmap(o.TEXTURE_2D),o.uniform1i(s["sampler"+n],n),e.nativeObject=t}(n[e],e);t.clearDirty()}}(),o.drawArrays(o.TRIANGLES,0,6*v)}}}},{"./webgl.js":56,"./webglAtlas.js":57}],60:[function(e,n,t){var L=e("../Utils/documentEvents.js");n.exports=function(n){if(n.webglInputEvents)return n.webglInputEvents;var f,c,l=null,p=[],v=[],h=[],g=[],t=[],m=[],y=[];!function(e){function r(e){E(t,[a,e]),i.x=e.clientX,i.y=e.clientY}function o(){c=e.getBoundingClientRect()}var i={x:0,y:0},a=null,s=1,u=+new Date,d=function(){L.off("mousemove",r),L.off("mouseup",d)};window.addEventListener("resize",o),o(),e.addEventListener("mousemove",function(e){var n,t;l||(s++%7==0&&(o(),s=1),n=!1,i.x=e.clientX-c.left,i.y=e.clientY-c.top,(t=b(i))&&a!==t?(a&&E(v,[a]),a=t,n=n||E(p,[a])):null===t&&a!==t&&(n=n||E(v,[a]),a=null),n&&w(e))}),e.addEventListener("mousedown",function(e){var n,t=!1;o(),i.x=e.clientX-c.left,i.y=e.clientY-c.top,n=[b(i),e],a=n[0]?(t=E(h,n),L.on("mousemove",r),L.on("mouseup",d),f=window.document.onselectstart,window.document.onselectstart=x,n[0]):null,t&&w(e)}),e.addEventListener("mouseup",function(e){var n=+new Date;i.x=e.clientX-c.left,i.y=e.clientY-c.top;var t=b(i),r=t===a;(t=[t||a,e])[0]&&(window.document.onselectstart=f,E(n-u<400&&r?y:m,t),u=n,E(g,t)&&w(e))})}(n.getGraphicsRoot());var r={mouseEnter:function(e){"function"==typeof e&&p.push(e);return r},mouseLeave:function(e){"function"==typeof e&&v.push(e);return r},mouseDown:function(e){"function"==typeof e&&h.push(e);return r},mouseUp:function(e){"function"==typeof e&&g.push(e);return r},mouseMove:function(e){"function"==typeof e&&t.push(e);return r},click:function(e){"function"==typeof e&&m.push(e);return r},dblClick:function(e){"function"==typeof e&&y.push(e);return r},mouseCapture:function(e){l=e},releaseMouseCapture:function(){l=null}};return n.webglInputEvents=r;function o(e,n,t){if(e&&e.size){var r=e.position,e=e.size;return r.x-e<n&&n<r.x+e&&r.y-e<t&&t<r.y+e}return!0}function b(e){return n.getNodeAtClientPos(e,o)}function w(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function x(e){return w(e),!1}function E(e,n){for(var t=0;t<e.length;t+=1)if(e[t].apply(void 0,n))return!0}}},{"../Utils/documentEvents.js":43}],61:[function(e,n,t){var r=e("./parseColor.js");n.exports=function(e){return{color:r(e)}}},{"./parseColor.js":54}],62:[function(e,n,t){var y=e("./webgl.js");n.exports=function(){var n,t,r,o,i,a,s,u,d,f,c=2*(2*Float32Array.BYTES_PER_ELEMENT+Uint32Array.BYTES_PER_ELEMENT),l=["precision mediump float;","varying vec4 color;","void main(void) {","   gl_FragColor = color;","}"].join("\n"),p=["attribute vec2 a_vertexPos;","attribute vec4 a_color;","uniform vec2 u_screenSize;","uniform mat4 u_transform;","varying vec4 color;","void main(void) {","   gl_Position = u_transform * vec4(a_vertexPos/u_screenSize, 0.0, 1.0);","   color = a_color.abgr;","}"].join("\n"),v=0,h=new ArrayBuffer(16*c),g=new Float32Array(h),m=new Uint32Array(h);return{load:function(e){o=y(t=e),n=o.createProgram(p,l),t.useProgram(n),i=o.getLocations(n,["a_vertexPos","a_color","u_screenSize","u_transform"]),t.enableVertexAttribArray(i.vertexPos),t.enableVertexAttribArray(i.color),r=t.createBuffer()},position:function(e,n,t){var r=6*e.id;g[r]=n.x,g[1+r]=n.y,m[2+r]=e.color,g[3+r]=t.x,g[4+r]=t.y,m[5+r]=e.color},createLink:function(e){var n,t,r;(v+1)*c>h.byteLength&&(n=new ArrayBuffer(2*h.byteLength),t=new Float32Array(n),(r=new Uint32Array(n)).set(m),g=t,m=r,h=n),v+=1,a=e.id},removeLink:function(e){0<v&&--v,e.id<v&&0<v&&o.copyArrayPart(m,6*e.id,6*v,6)},updateTransform:function(e){f=!0,d=e},updateSize:function(e,n){s=e,u=n,f=!0},render:function(){t.useProgram(n),t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,h,t.DYNAMIC_DRAW),f&&(f=!1,t.uniformMatrix4fv(i.transform,!1,d),t.uniform2f(i.screenSize,s,u)),t.vertexAttribPointer(i.vertexPos,2,t.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0),t.vertexAttribPointer(i.color,4,t.UNSIGNED_BYTE,!0,3*Float32Array.BYTES_PER_ELEMENT,8),t.drawArrays(t.LINES,0,2*v),a=v-1},bringToFront:function(e){a>e.id&&o.swapArrayPart(g,6*e.id,6*a,6),0<a&&--a},getFrontLinkId:function(){return a}}}},{"./webgl.js":56}],63:[function(e,n,t){var m=e("./webgl.js");n.exports=function(){var n,t,r,o,i,a,s,u,d,f=3*Float32Array.BYTES_PER_ELEMENT+Uint32Array.BYTES_PER_ELEMENT,c=["precision mediump float;","varying vec4 color;","void main(void) {","   gl_FragColor = color;","}"].join("\n"),l=["attribute vec3 a_vertexPos;","attribute vec4 a_color;","uniform vec2 u_screenSize;","uniform mat4 u_transform;","varying vec4 color;","void main(void) {","   gl_Position = u_transform * vec4(a_vertexPos.xy/u_screenSize, 0, 1);","   gl_PointSize = a_vertexPos.z * u_transform[0][0];","   color = a_color.abgr;","}"].join("\n"),p=new ArrayBuffer(16*f),v=new Float32Array(p),h=new Uint32Array(p),g=0;return{load:function(e){i=m(t=e),n=i.createProgram(l,c),t.useProgram(n),o=i.getLocations(n,["a_vertexPos","a_color","u_screenSize","u_transform"]),t.enableVertexAttribArray(o.vertexPos),t.enableVertexAttribArray(o.color),r=t.createBuffer()},position:function(e,n){var t=e.id;v[4*t]=n.x,v[4*t+1]=-n.y,v[4*t+2]=e.size,h[4*t+3]=e.color},updateTransform:function(e){d=!0,u=e},updateSize:function(e,n){a=e,s=n,d=!0},removeNode:function(e){0<g&&--g;e.id<g&&0<g&&i.copyArrayPart(h,4*e.id,4*g,4)},createNode:function(){(function(){var e,n,t;(g+1)*f>=p.byteLength&&(e=new ArrayBuffer(2*p.byteLength),n=new Float32Array(e),(t=new Uint32Array(e)).set(h),v=n,h=t,p=e)})(),g+=1},replaceProperties:function(){},render:function(){t.useProgram(n),t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,p,t.DYNAMIC_DRAW),d&&(d=!1,t.uniformMatrix4fv(o.transform,!1,u),t.uniform2f(o.screenSize,a,s));t.vertexAttribPointer(o.vertexPos,3,t.FLOAT,!1,4*Float32Array.BYTES_PER_ELEMENT,0),t.vertexAttribPointer(o.color,4,t.UNSIGNED_BYTE,!0,4*Float32Array.BYTES_PER_ELEMENT,12),t.drawArrays(t.POINTS,0,g)}}}},{"./webgl.js":56}],64:[function(e,n,t){var r=e("./parseColor.js");n.exports=function(e,n){return{size:"number"==typeof e?e:10,color:r(n)}}},{"./parseColor.js":54}],65:[function(e,n,t){n.exports="0.10.1"},{}]},{},[1])(1)});